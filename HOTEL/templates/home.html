{% extends 'base.html' %}

{% block title %} Home {% endblock %}

{% block styles %}
<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
/>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=Khula:wght@300;400;600;700;800&family=Lusitana:wght@400;700&family=Mrs+Sheppards&family=Noto+Sans+Khmer:wght@100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Tiro+Tamil:ital@0;1&display=swap"
  rel="stylesheet"
/>
<link rel="stylesheet" href="../static/css/home.css" />
{% endblock %}

{% block content %}
<div class="background">
  <div class="background-wrapper">
    <section class="main-content">
      <div class="box1">
        <div class="location-container">
          <select name="location-type">
            <option disabled selected>Select Location</option>
              {% if locations %}
                {% for loc in locations %}
                  <option value="{{loc[0]}}">{{ loc[0].value }}</option>
                {% endfor %}
              {% endif %}
          </select>
        </div>
        <div class="datepick-container">
          <input
            type="text"
            class="date-input"
            placeholder="Select Start Date"
          />
          <div class="datepick" hidden>
            <div class="datepick-header">
              <button class="prev">Prev</button>
              <div>
                <select class="month-input">
                  <option>January</option>
                  <option>February</option>
                  <option>March</option>
                  <option>April</option>
                  <option>May</option>
                  <option>June</option>
                  <option>July</option>
                  <option>August</option>
                  <option>September</option>
                  <option>October</option>
                  <option>November</option>
                  <option>December</option>
                </select>
                <input type="number" class="year-input" />
              </div>
              <button class="next">Next</button>
            </div>
            <div class="days">
              <span>Sun</span>
              <span>Mon</span>
              <span>Tue</span>
              <span>Wed</span>
              <span>Thu</span>
              <span>Fri</span>
              <span>Sat</span>
            </div>
            <div class="date"></div>
            <div class="datepick-footer">
              <button class="cancel">Cancel</button>
              <button class="apply">Apply</button>
            </div>
          </div>
        </div>
        <div class="datepick-container-end">
          <input
            type="text"
            class="date-input-end"
            placeholder="Select End Date"
          />
          <div class="datepick-end" hidden>
            <div class="datepick-header-end">
              <button class="prev-end">Prev</button>
              <div>
                <select class="month-input-end">
                  <option>January</option>
                  <option>February</option>
                  <option>March</option>
                  <option>April</option>
                  <option>May</option>
                  <option>June</option>
                  <option>July</option>
                  <option>August</option>
                  <option>September</option>
                  <option>October</option>
                  <option>November</option>
                  <option>December</option>
                </select>
                <input type="number" class="year-input-end" />
              </div>
              <button class="next-end">Next</button>
            </div>
            <div class="days-end">
              <span>Sun</span>
              <span>Mon</span>
              <span>Tue</span>
              <span>Wed</span>
              <span>Thu</span>
              <span>Fri</span>
              <span>Sat</span>
            </div>
            <div class="date-end"></div>
            <div class="datepick-footer-end">
              <button class="cancel-end">Cancel</button>
              <button class="apply-end">Apply</button>
            </div>
          </div>
        </div>
        <button class="search">Search</button>
      </div>
      <div class="boxes-container">
        <div class="hero-box">
          <div class="hero-text">
            <h1>Welcome to Ocean Vista!</h1>
            <p>
              Your oasis by the sea! Nestled along the sun-kissed shores of
              Malibu, our resort combines modern comfort with timeless coastal
              charm. Wake up to the gentle sound of the waves, soak in
              breathtaking ocean views from your private balcony, and savor warm
              hospitality at every turn.
            </p>
          </div>
          <div class="hero-image">
            <img src="../static/images/hotel.jpg" alt="Hotel View" />
            <div class="hero-fade"></div>
          </div>
        </div>
        <div class="box2">
          <div class="box2-image">
            <img src="../static/images/hotelimg2.jpg" alt="Hotel View" />
          </div>
          <div class="box2-text">
            <p>
              Whether you’re here for a romantic getaway, family vacation, or a
              solo adventure, we invite you to discover a world of relaxation
              and delight. Unwind in our spacious suites, sample fresh local
              cuisine, and take full advantage of our luxurious amenities—all
              just steps away from sandy beaches and captivating sunsets.
              Experience a stay where every sunrise brings new inspiration and
              every evening is a memory in the making. Welcome home to Ocean
              Vista!
            </p>
          </div>
        </div>
        <div class="box3">
          <div class="box3text">
            <h1>"Your Perfect Staycation Destination!"</h1>
            <p>
              Looking for the perfect getaway? Look no further than Hotel Ocean
              Vista, your ultimate beachfront escape! Nestled along the
              picturesque Beach Road, our hotel offers the perfect combination
              of relaxation, entertainment, and breathtaking views. Hotel Ocean
              Vista is surrounded by a lively nightlife scene. Our proximity to
              trendy pubs means you can dance the night away, enjoy live music,
              and mingle with fellow travelers. Make lasting memories with
              friends or simply relish a quiet evening by the beach.
            </p>
          </div>
        </div>
        <div class="box4">
          <div class="box4-image">
            <img src="../static/images/cocktail.png" alt="martini" />
          </div>
          <div class="feature-cards">
            <div class="feature-card">
              <img src="../static/images/key.png" alt="Baggage Hold" />
              <h3>Smart Key</h3>
              <p>
                The keys are activated through digital cards for easy and secure
                access.
              </p>
            </div>
            <div class="feature-card">
              <img src="../static/images/bag.png" alt="Baggage" />
              <h3>Baggage</h3>
              <p>
                Hotel bellhops will store your luggage for a tip—travel light
                and carefree!
              </p>
            </div>
          </div>
        </div>
        <div class="box5-box">
          <div class="box5-image">
            <img src="../static/images/hotel.jpg" alt="Hotel View" />
            <div class="box5-fade"></div>
          </div>
          <div class="box5-text">
            <h1>“Check the Best Stay With Luxury Rooms”</h1>
            <p>Discover your dream destination, one click away!!!</p>
            <a class="rooms-btn" href="indent">Rooms</a>
          </div>
        </div>
      </div>
    </section>
    <script>
    const datepick = document.querySelector('.datepick');
    const dateinput = document.querySelector('.date-input');
    const yearinput = datepick.querySelector('.year-input');
    const monthinput = datepick.querySelector('.month-input');
    const cancelBtn = datepick.querySelector('.cancel');
    const applyBtn = datepick.querySelector('.apply');
    const nextBtn = datepick.querySelector('.next');
    const prevBtn = datepick.querySelector('.prev');
    const date = datepick.querySelector('.date');

    let selectdate = new Date();
    let year = selectdate.getFullYear();
    let month = selectdate.getMonth();

    dateinput.addEventListener('click', () => {
      datepick.hidden = false;
    });

    cancelBtn.addEventListener('click', () => {
      datepick.hidden = true;
    });

    applyBtn.addEventListener('click', () => {
      dateinput.value = selectdate.toLocaleDateString('en-US', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
      });
      datepick.hidden = true;
      calculatePrice();
    });

    nextBtn.addEventListener('click', () => {
      if (month === 11) year++;
      month = (month + 1) % 12;
      displayDate();
    });

    prevBtn.addEventListener('click', () => {
      if (month === 0) year--;
      month = (month - 1 + 12) % 12;
      displayDate();
    });

    monthinput.addEventListener('change', () => {
      month = monthinput.selectedIndex;
      displayDate();
    });

    yearinput.addEventListener('change', () => {
      year = yearinput.value;
      displayDate();
    });

    const updateYearMonth = () => {
      monthinput.selectedIndex = month;
      yearinput.value = year;
    };

    const handleDateClick = (e) => {
      const button = e.target;
      const selectedDay = parseInt(button.textContent);
      const candidateDate = new Date(year, month, selectedDay);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      candidateDate.setHours(0, 0, 0, 0);

      if (candidateDate < today) {
        alert("Invalid date.");
        return;
      }

      const selected = date.querySelector('.selected');
      selected && selected.classList.remove('selected');
      button.classList.add('selected');
      selectdate = candidateDate;
    };

    const displayDate = () => {
      updateYearMonth();
      date.innerHTML = "";
      const lastofPrevMonth = new Date(year, month, 0);
      for (let i = 0; i <= lastofPrevMonth.getDay(); i++) {
        const text = lastofPrevMonth.getDate() - lastofPrevMonth.getDay() + i;
        const button = createButton(text, true);
        date.appendChild(button);
      }
      const lastofMonth = new Date(year, month + 1, 0);
      for (let i = 1; i <= lastofMonth.getDate(); i++) {
        const button = createButton(i, false);
        button.addEventListener('click', handleDateClick);
        date.appendChild(button);
      }
      const firstofNextMonth = new Date(year, month + 1, 1);
      for (let i = firstofNextMonth.getDay(); i < 7; i++) {
        const text = firstofNextMonth.getDate() - firstofNextMonth.getDay() + i;
        const button = createButton(text, true);
        date.appendChild(button);
      }
    };

    const createButton = (text, isDisabled = false) => {
      const currentDate = new Date();
      const isToday =
        currentDate.getDate() === text &&
        currentDate.getFullYear() === year &&
        currentDate.getMonth() === month;
      const select =
        selectdate.getDate() === text &&
        selectdate.getFullYear() === year &&
        selectdate.getMonth() === month;
      const button = document.createElement('button');
      button.textContent = text;
      button.disabled = isDisabled;
      button.classList.toggle('today', isToday);
      button.classList.toggle('select', select);
      return button;
    };

    displayDate();

    const datepickEnd = document.querySelector('.datepick-end');
    const dateinputEnd = document.querySelector('.date-input-end');
    const yearinputEnd = datepickEnd.querySelector('.year-input-end');
    const monthinputEnd = datepickEnd.querySelector('.month-input-end');
    const cancelBtnEnd = datepickEnd.querySelector('.cancel-end');
    const applyBtnEnd = datepickEnd.querySelector('.apply-end');
    const nextBtnEnd = datepickEnd.querySelector('.next-end');
    const prevBtnEnd = datepickEnd.querySelector('.prev-end');
    const dateEnd = datepickEnd.querySelector('.date-end');

    let selectdateEnd = new Date();
    let yearEnd = selectdateEnd.getFullYear();
    let monthEnd = selectdateEnd.getMonth();

    dateinputEnd.addEventListener('click', () => {
      datepickEnd.hidden = false;
    });

    cancelBtnEnd.addEventListener('click', () => {
      datepickEnd.hidden = true;
    });

    applyBtnEnd.addEventListener('click', () => {
      dateinputEnd.value = selectdateEnd.toLocaleDateString('en-US', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
      });
      datepickEnd.hidden = true;
      calculatePrice();
    });

    nextBtnEnd.addEventListener('click', () => {
      if (monthEnd === 11) yearEnd++;
      monthEnd = (monthEnd + 1) % 12;
      displayDateEnd();
    });

    prevBtnEnd.addEventListener('click', () => {
      if (monthEnd === 0) yearEnd--;
      monthEnd = (monthEnd - 1 + 12) % 12;
      displayDateEnd();
    });

    monthinputEnd.addEventListener('change', () => {
      monthEnd = monthinputEnd.selectedIndex;
      displayDateEnd();
    });

    yearinputEnd.addEventListener('change', () => {
      yearEnd = yearinputEnd.value;
      displayDateEnd();
    });

    const updateYearMonthEnd = () => {
      monthinputEnd.selectedIndex = monthEnd;
      yearinputEnd.value = yearEnd;
    };

    const handleDateClickEnd = (e) => {
      const button = e.target;
      const selectedDay = parseInt(button.textContent);
      const candidateDate = new Date(yearEnd, monthEnd, selectedDay);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      candidateDate.setHours(0, 0, 0, 0);

      if (candidateDate < today) {
        alert("Invalid date.");
        return;
      }

      const selected = dateEnd.querySelector('.selected');
      selected && selected.classList.remove('selected');
      button.classList.add('selected');
      selectdateEnd = candidateDate;
    };

    const displayDateEnd = () => {
      updateYearMonthEnd();
      dateEnd.innerHTML = "";
      const lastofPrevMonthEnd = new Date(yearEnd, monthEnd, 0);
      for (let i = 0; i <= lastofPrevMonthEnd.getDay(); i++) {
        const text = lastofPrevMonthEnd.getDate() - lastofPrevMonthEnd.getDay() + i;
        const button = createButtonEnd(text, true);
        dateEnd.appendChild(button);
      }
      const lastofMonthEnd = new Date(yearEnd, monthEnd + 1, 0);
      for (let i = 1; i <= lastofMonthEnd.getDate(); i++) {
        const button = createButtonEnd(i, false);
        button.addEventListener('click', handleDateClickEnd);
        dateEnd.appendChild(button);
      }
      const firstofNextMonthEnd = new Date(yearEnd, monthEnd + 1, 1);
      for (let i = firstofNextMonthEnd.getDay(); i < 7; i++) {
        const text = firstofNextMonthEnd.getDate() - firstofNextMonthEnd.getDay() + i;
        const button = createButtonEnd(text, true);
        dateEnd.appendChild(button);
      }
    };

    const createButtonEnd = (text, isDisabled = false) => {
      const currentDate = new Date();
      const isToday =
        currentDate.getDate() === text &&
        currentDate.getFullYear() === yearEnd &&
        currentDate.getMonth() === monthEnd;
      const select =
        selectdateEnd.getDate() === text &&
        selectdateEnd.getFullYear() === yearEnd &&
        selectdateEnd.getMonth() === monthEnd;
      const button = document.createElement('button');
      button.textContent = text;
      button.disabled = isDisabled;
      button.classList.toggle('today', isToday);
      button.classList.toggle('select', select);
      return button;
    };

    displayDateEnd();

    dateinput.addEventListener('click', () => {
      datepick.hidden = false;
      datepickEnd.hidden = true;
    });

    dateinputEnd.addEventListener('click', () => {
      datepickEnd.hidden = false;
      datepick.hidden = true;
    });

    const roomSelect = document.querySelector('select[name="location-type"]');
    roomSelect.addEventListener('focus', () => {
      datepick.hidden = true;
      datepickEnd.hidden = true;
    });

    function calculatePrice() {
      const roomType = roomSelect.value;
      if (!dateinput.value || !dateinputEnd.value || !roomType || roomType === "Select Room") {
        return;
      }
      const startParts = dateinput.value.split('/');
      const endParts = dateinputEnd.value.split('/');
      const startDate = new Date(startParts[2], startParts[0] - 1, startParts[1]);
      const endDate = new Date(endParts[2], endParts[0] - 1, endParts[1]);
      let weekdayPrice = 0;
      let weekendPrice = 0;
      if (roomType === "Standard") {
        weekdayPrice = 100;
        weekendPrice = 140;
      } else if (roomType === "Deluxe") {
        weekdayPrice = 140;
        weekendPrice = 180;
      } else if (roomType === "Suite") {
        weekdayPrice = 180;
        weekendPrice = 220;
      }
      let totalPrice = 0;
      let nights = 0;
      for (let d = new Date(startDate); d < endDate; d.setDate(d.getDate() + 1)) {
        nights++;
        let day = d.getDay();
        if (day === 0 || day === 6) {
          totalPrice += weekendPrice;
        } else {
          totalPrice += weekdayPrice;
        }
      }
      document.getElementById('nights-display').textContent = "Nights: " + nights;
      document.getElementById('total-price').textContent = "Total Price: $" + totalPrice;
    }

    dateinput.addEventListener('change', calculatePrice);
    dateinputEnd.addEventListener('change', calculatePrice);
    roomSelect.addEventListener('change', calculatePrice);

    dateinput.addEventListener('change', () => {
      const typedDate = new Date(dateinput.value);
      if (!isNaN(typedDate.getTime())) {
        selectdate = typedDate;
        year = typedDate.getFullYear();
        month = typedDate.getMonth();
        displayDate();
        calculatePrice();
      } else {
        alert("Invalid date typed. Please use a valid format (e.g. MM/DD/YYYY).");
      }
    });

    dateinputEnd.addEventListener('change', () => {
      const typedDateEnd = new Date(dateinputEnd.value);
      if (!isNaN(typedDateEnd.getTime())) {
        selectdateEnd = typedDateEnd;
        yearEnd = typedDateEnd.getFullYear();
        monthEnd = typedDateEnd.getMonth();
        displayDateEnd();
        calculatePrice();
      } else {
        alert("Invalid end date typed. Please use a valid format (e.g. MM/DD/YYYY).");
      }
    });
    </script>
  </div>
</div>
{% endblock %}
